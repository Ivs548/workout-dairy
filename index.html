<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üèãÔ∏è –î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f0f9f0 0%, #d1f2d1 100%);
            color: #1a472a;
            padding: 10px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .header h1 {
            font-size: 1.5em;
            color: #1a472a;
            margin-bottom: 15px;
        }
        
        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π - –ü–ï–†–í–´–ô –ë–õ–û–ö */
        .categories-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .category-card {
            background: white;
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .category-card.expanded {
            margin-bottom: 0;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .category-icon {
            font-size: 1.2em;
            color: #27ae60;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        
        .category-name {
            font-size: 0.9em;
            font-weight: 600;
            flex-grow: 1;
        }
        
        .category-count {
            font-size: 0.8em;
            color: #7f8c8d;
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .category-arrow {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-left: 8px;
            transition: transform 0.3s;
        }
        
        .category-card.expanded .category-arrow {
            transform: rotate(180deg);
        }
        
        /* –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-exercises {
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            margin-top: -2px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .category-exercises.show {
            display: flex;
        }
        
        .category-exercise-item {
            background: white;
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid #27ae60;
        }
        
        .category-exercise-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .category-exercise-name {
            font-size: 0.9em;
            font-weight: 500;
            flex-grow: 1;
        }
        
        .category-exercise-stats {
            font-size: 0.8em;
            color: #7f8c8d;
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è - –í–¢–û–†–û–ô –ë–õ–û–ö */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            background: white;
            padding: 8px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .tab {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            border: none;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ - –¢–†–ï–¢–ò–ô –ë–õ–û–ö (–ø–æ–¥ –∫–Ω–æ–ø–∫–∞–º–∏) */
        .tab-content {
            display: none;
            margin-bottom: 15px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å - —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .calendar-section {
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-title {
            font-weight: 600;
            font-size: 1em;
        }
        
        .calendar-arrow {
            background: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: #27ae60;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .calendar-header {
            text-align: center;
            font-size: 0.8em;
            color: #7f8c8d;
            padding: 5px 0;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day.has-workout {
            background: #27ae60;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background: #2ecc71;
            color: white;
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.3);
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        /* –§–æ—Ä–º—ã */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .form-card h2 {
            margin-bottom: 15px;
            color: #1a472a;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            transition: border 0.3s;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #27ae60;
            outline: none;
        }
        
        input[type="date"] {
            font-size: 0.95em;
            min-height: 44px;
        }
        
        .compact-input {
            font-size: 0.9em;
            padding: 10px;
        }
        
        /* –ù–û–í–´–ô –°–¢–ò–õ–¨: –í–µ—Å, –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è, –ü–æ–¥—Ö–æ–¥—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
        .compact-inputs-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .compact-inputs-row .form-group {
            margin-bottom: 0;
        }
        
        .compact-inputs-row input {
            text-align: center;
            padding: 10px 5px;
            font-size: 0.9em;
        }
        
        .cardio-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .hidden-field {
            display: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –°–¢–ò–õ–¨: –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ) */
        .compact-workout-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            position: relative;
            border-left: 4px solid #27ae60;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .compact-workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .compact-workout-name {
            font-size: 0.95em;
            font-weight: 600;
            color: #1a472a;
            flex-grow: 1;
        }
        
        .compact-workout-edit-btn {
            background: none;
            border: none;
            color: #27ae60;
            font-size: 0.9em;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 5px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .compact-workout-edit-btn:hover {
            background: #f0f9f0;
        }
        
        .compact-workout-stats {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.85em;
        }
        
        .compact-workout-stat {
            flex: 1;
            text-align: center;
            background: #f8f9fa;
            padding: 6px;
            border-radius: 6px;
        }
        
        .compact-workout-stat-label {
            font-size: 0.75em;
            color: #7f8c8d;
            margin-bottom: 2px;
        }
        
        .compact-workout-stat-value {
            font-weight: 600;
            color: #1a472a;
        }
        
        .compact-workout-difficulty {
            font-size: 0.8em;
            color: #7f8c8d;
            padding-top: 6px;
            border-top: 1px solid #f0f0f0;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - 3 —Å—Ç—Ä–æ–∫–∏ –ø–æ 2 –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, auto);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card-compact {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .stat-value-compact {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 5px;
        }
        
        .stat-label-compact {
            font-size: 0.85em;
            color: #7f8c8d;
        }
        
        .stat-date {
            font-size: 0.75em;
            color: #95a5a6;
            margin-top: 3px;
        }
        
        /* –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è - –ü–û–î –ö–ê–õ–ï–ù–î–ê–†–ï–ú */
        .day-workouts {
            margin-top: 15px;
        }
        
        .date-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-title {
            font-size: 1em;
            font-weight: bold;
        }
        
        .date-workout-count {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        /* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–Ω—è */
        .day-comment {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .day-comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .day-comment-title {
            font-weight: 600;
            color: #1a472a;
            font-size: 0.95em;
        }
        
        .day-comment-edit-btn {
            background: none;
            border: none;
            color: #27ae60;
            font-size: 0.9em;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 5px;
        }
        
        .day-comment-text {
            font-size: 0.9em;
            color: #7f8c8d;
            line-height: 1.4;
        }
        
        /* –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ */
        .analytics-chart {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .chart-container {
            width: 100%;
            height: 200px;
            position: relative;
            margin-top: 15px;
        }
        
        .chart-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        /* –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ - –ü–û–°–õ–ï–î–ù–ò–ô –ë–õ–û–ö */
        .backup-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .backup-section h3 {
            margin-bottom: 15px;
            color: #1a472a;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .backup-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn-backup {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 14px;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-backup:hover {
            background: #eafaf1;
            border-color: #27ae60;
        }
        
        .btn-backup.save {
            color: #27ae60;
        }
        
        .btn-backup.restore {
            color: #3498db;
        }
        
        .backup-info {
            margin-top: 10px;
            font-size: 0.85em;
            color: #7f8c8d;
            text-align: center;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            border-left: 4px solid #27ae60;
        }
        
        .notification.error {
            border-left: 4px solid #e74c3c;
        }
        
        .notification.info {
            border-left: 4px solid #3498db;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            flex: 1;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è */
        .selected-exercise-indicator {
            background: #eafaf1;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }
        
        /* –ú–µ–Ω—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è */
        .more-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .more-btn:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 40px;
            right: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 100px;
            display: none;
            overflow: hidden;
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border: none;
            width: 100%;
            background: none;
            font-size: 0.9em;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .dropdown-item.edit {
            color: #27ae60;
        }
        
        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .calendar {
                gap: 2px;
                padding: 8px;
            }
            
            .cardio-inputs {
                grid-template-columns: 1fr;
            }
            
            .compact-inputs-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .backup-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .tab {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <!-- 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>üèãÔ∏è –î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
    </div>
    
    <!-- 2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
    <div id="categories-container" class="categories-grid"></div>
    
    <!-- 3. –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="tabs">
        <button class="tab active" data-tab="home" title="–ì–ª–∞–≤–Ω–∞—è">
            <i class="fas fa-home"></i>
        </button>
        <button class="tab" data-tab="catalog" title="–ö–∞—Ç–∞–ª–æ–≥ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π">
            <i class="fas fa-dumbbell"></i>
        </button>
        <button class="tab" data-tab="workouts" title="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
            <i class="fas fa-running"></i>
        </button>
        <button class="tab" data-tab="stats" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
            <i class="fas fa-chart-line"></i>
        </button>
        <button class="tab" data-tab="analytics" title="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">
            <i class="fas fa-chart-bar"></i>
        </button>
    </div>
    
    <!-- 4. –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ (–ø–æ–¥ –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏) -->
    
    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º -->
    <div class="tab-content active" id="home-tab">
        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
        <div class="calendar-section">
            <div class="calendar-nav">
                <button class="calendar-arrow" id="prev-month">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="calendar-title" id="calendar-title"></div>
                <button class="calendar-arrow" id="next-month">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="calendar" id="calendar"></div>
        </div>
        
        <!-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è -->
        <div id="selected-day-workouts" class="day-workouts"></div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
    <div class="tab-content" id="catalog-tab">
        <div class="form-card">
            <h2><i class="fas fa-plus-circle"></i> –ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
            <div class="form-group">
                <input type="text" id="exercise-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è">
            </div>
            <div class="form-group">
                <select id="exercise-category">
                    <option value="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</option>
                    <option value="–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã">–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã</option>
                    <option value="–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞">–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞</option>
                    <option value="–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å">–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å</option>
                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            <div class="form-group">
                <textarea id="exercise-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
            </div>
            <button onclick="addExercise()" class="btn-primary">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            </button>
        </div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
    <div class="tab-content" id="workouts-tab">
        <div class="form-card" id="workout-form-card">
            <h2><i class="fas fa-running"></i> –ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
            
            <div id="selected-exercise-indicator" class="selected-exercise-indicator" style="display: none;">
                <div style="font-weight: 600; color: #1a472a;" id="selected-exercise-name"></div>
                <div style="font-size: 0.9em; color: #7f8c8d;" id="selected-exercise-category"></div>
            </div>
            
            <div class="form-group">
                <select id="workout-exercise">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                </select>
            </div>
            <div class="form-group">
                <input type="date" id="workout-date" class="compact-input">
            </div>
            
            <!-- –í–ï–°, –ü–û–í–¢–û–†–ï–ù–ò–Ø, –ü–û–î–•–û–î–´ –í –û–î–ù–û–ô –°–¢–†–û–ö–ï -->
            <div id="standard-fields" class="standard-inputs hidden-field">
                <div class="compact-inputs-row">
                    <div class="form-group">
                        <input type="number" id="weight" placeholder="–í–µ—Å (–∫–≥)" step="0.5" min="0" class="compact-input">
                    </div>
                    <div class="form-group">
                        <input type="number" id="reps" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" min="1" class="compact-input">
                    </div>
                    <div class="form-group">
                        <input type="number" id="sets" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" class="compact-input">
                    </div>
                </div>
                
                <!-- –°–õ–û–ñ–ù–û–°–¢–¨ –ü–û–î –ù–ò–ú–ò -->
                <div class="form-group" style="margin-top: 8px;">
                    <input type="text" id="difficulty" placeholder="–ª–µ–≥–∫–æ/—Å—Ä–µ–¥–Ω–µ/—Ç—è–∂–µ–ª–æ" class="compact-input">
                </div>
            </div>
            
            <!-- –ö–ê–†–î–ò–û -->
            <div id="cardio-fields" class="cardio-inputs hidden-field">
                <div class="compact-inputs-row">
                    <div class="form-group">
                        <input type="number" id="level" placeholder="–£—Ä–æ–≤–µ–Ω—å" step="0.1" min="0" class="compact-input">
                    </div>
                    <div class="form-group">
                        <input type="number" id="distance" placeholder="–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)" step="0.1" min="0" class="compact-input">
                    </div>
                    <div class="form-group">
                        <input type="number" id="time" placeholder="–í—Ä–µ–º—è (–º–∏–Ω)" step="1" min="0" class="compact-input">
                    </div>
                </div>
                
                <!-- –°–õ–û–ñ–ù–û–°–¢–¨ –ü–û–î –ù–ò–ú–ò -->
                <div class="form-group" style="margin-top: 8px;">
                    <input type="text" id="cardio-difficulty" placeholder="–ª–µ–≥–∫–æ/—Å—Ä–µ–¥–Ω–µ/—Ç—è–∂–µ–ª–æ" class="compact-input">
                </div>
            </div>
            
            <button onclick="addWorkout()" class="btn-primary">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </div>
        
        <div class="form-card">
            <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
            <div id="exercise-history-container">
                <p style="text-align: center; color: #7f8c8d;">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏</p>
            </div>
        </div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="tab-content" id="stats-tab">
        <div class="form-card">
            <h2><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            
            <div class="stats-grid">
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="total-workouts">0</div>
                    <div class="stat-label-compact">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="this-month">0</div>
                    <div class="stat-label-compact">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="total-distance">0</div>
                    <div class="stat-label-compact">–ö–º (–∫–∞—Ä–¥–∏–æ)</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="best-arms-back">0</div>
                    <div class="stat-label-compact">–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞</div>
                    <div class="stat-date" id="best-arms-back-date">-</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="best-legs">0</div>
                    <div class="stat-label-compact">–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã</div>
                    <div class="stat-date" id="best-legs-date">-</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="best-chest">0</div>
                    <div class="stat-label-compact">–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å</div>
                    <div class="stat-date" id="best-chest-date">-</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
    <div class="tab-content" id="analytics-tab">
        <div class="form-card">
            <h2><i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            
            <div class="form-group">
                <select id="analytics-exercise">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</option>
                </select>
            </div>
            
            <div class="analytics-chart">
                <h3 style="font-size: 1em; margin-bottom: 10px;">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é</h3>
                <div class="chart-container" id="progress-chart">
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line" style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 7. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="backup-section">
        <h3><i class="fas fa-database"></i> –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        <div class="backup-buttons">
            <button onclick="createBackup()" class="btn-backup save">
                <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
            </button>
            <button onclick="restoreBackup()" class="btn-backup restore">
                <i class="fas fa-history"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
        <div class="backup-info" id="backup-info">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
    <div class="modal" id="edit-workout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h2>
                <button class="close-modal" onclick="closeEditWorkoutModal()">&times;</button>
            </div>
            <form id="edit-workout-form">
                <input type="hidden" id="edit-workout-id">
                <input type="hidden" id="edit-workout-category">
                
                <div class="form-group">
                    <label style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 5px; display: block;">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</label>
                    <div style="font-weight: 600; padding: 10px; background: #f8f9fa; border-radius: 8px;" id="edit-workout-exercise-name"></div>
                </div>
                
                <div class="form-group">
                    <input type="date" id="edit-workout-date" class="compact-input" required>
                </div>
                
                <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è -->
                <div id="edit-standard-fields" class="standard-inputs hidden-field">
                    <div class="compact-inputs-row">
                        <div class="form-group">
                            <input type="number" id="edit-weight" placeholder="–í–µ—Å (–∫–≥)" step="0.5" min="0" class="compact-input" required>
                        </div>
                        <div class="form-group">
                            <input type="number" id="edit-reps" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" min="1" class="compact-input" required>
                        </div>
                        <div class="form-group">
                            <input type="number" id="edit-sets" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" class="compact-input" required>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 8px;">
                        <input type="text" id="edit-difficulty" placeholder="–ª–µ–≥–∫–æ/—Å—Ä–µ–¥–Ω–µ/—Ç—è–∂–µ–ª–æ" class="compact-input">
                    </div>
                </div>
                
                <!-- –ö–∞—Ä–¥–∏–æ –ø–æ–ª—è -->
                <div id="edit-cardio-fields" class="cardio-inputs hidden-field">
                    <div class="compact-inputs-row">
                        <div class="form-group">
                            <input type="number" id="edit-level" placeholder="–£—Ä–æ–≤–µ–Ω—å" step="0.1" min="0" class="compact-input">
                        </div>
                        <div class="form-group">
                            <input type="number" id="edit-distance" placeholder="–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)" step="0.1" min="0" class="compact-input">
                        </div>
                        <div class="form-group">
                            <input type="number" id="edit-time" placeholder="–í—Ä–µ–º—è (–º–∏–Ω)" step="1" min="0" class="compact-input">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 8px;">
                        <input type="text" id="edit-cardio-difficulty" placeholder="–ª–µ–≥–∫–æ/—Å—Ä–µ–¥–Ω–µ/—Ç—è–∂–µ–ª–æ" class="compact-input">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditWorkoutModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
    <div class="modal" id="exercise-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="edit-exercise-form">
                <input type="hidden" id="edit-exercise-id">
                <div class="form-group">
                    <input type="text" id="edit-exercise-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                <div class="form-group">
                    <select id="edit-exercise-category" required>
                        <option value="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</option>
                        <option value="–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã">–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã</option>
                        <option value="–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞">–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞</option>
                        <option value="–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å">–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å</option>
                        <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="edit-exercise-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeExerciseModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let exercises = JSON.parse(localStorage.getItem('workoutDiaryExercises')) || [];
        let workouts = JSON.parse(localStorage.getItem('workoutDiaryWorkouts')) || [];
        let dayComments = JSON.parse(localStorage.getItem('workoutDiaryDayComments')) || {};
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;
        let expandedCategories = new Set();
        let currentSelectedExerciseId = null;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        const backupSettings = JSON.parse(localStorage.getItem('workoutDiaryBackup')) || {
            lastBackup: null,
            reminderShown: false
        };

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
        const categories = [
            { id: '–ö–∞—Ä–¥–∏–æ', name: '–ö–∞—Ä–¥–∏–æ', icon: 'fa-heart-pulse' },
            { id: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', name: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', icon: 'fa-person-running' },
            { id: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', name: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', icon: 'fa-dumbbell' },
            { id: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', name: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', icon: 'fa-user' },
            { id: '–î—Ä—É–≥–æ–µ', name: '–î—Ä—É–≥–æ–µ', icon: 'fa-ellipsis' }
        ];

        // –¢–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
        let activeMenu = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
            const today = new Date();
            const todayString = formatDateForInput(today);
            const workoutDateInput = document.getElementById('workout-date');
            if (workoutDateInput) {
                workoutDateInput.value = todayString;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadCategories();
            updateExerciseDropdown();
            updateAnalyticsDropdown();
            updateStats();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            initCalendar();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
            checkBackupReminder();
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
            updateBackupInfo();
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è input type="date"
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        function formatDateForComparison(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∫–æ–º–ø–∞–∫—Ç–Ω–æ
        function formatDateCompact(date) {
            const d = new Date(date);
            const day = d.getDate().toString().padStart(2, '0');
            const month = (d.getMonth() + 1).toString().padStart(2, '0');
            return `${day}.${month}`;
        }

        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º (—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏)
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabId}-tab`);
                    
                    // –ï—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ - —Å–∫—Ä—ã–≤–∞–µ–º –µ–µ
                    if (this.classList.contains('active') && tabContent.classList.contains('active')) {
                        this.classList.remove('active');
                        tabContent.classList.remove('active');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é
                        document.querySelector('.tab[data-tab="home"]').classList.add('active');
                        document.getElementById('home-tab').classList.add('active');
                    } else {
                        // –ò–Ω–∞—á–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                        
                        this.classList.add('active');
                        tabContent.classList.add('active');
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    if (tabId === 'stats') {
                        updateStats();
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                    if (tabId === 'workouts') {
                        loadExerciseHistory();
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    if (tabId === 'analytics') {
                        updateAnalytics();
                    }
                });
            });
            
            // –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            const editForm = document.getElementById('edit-exercise-form');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveExerciseChanges();
                });
            }
            
            // –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const editWorkoutForm = document.getElementById('edit-workout-form');
            if (editWorkoutForm) {
                editWorkoutForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveWorkoutChanges();
                });
            }
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', () => {
                    currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                    renderCalendar();
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', () => {
                    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                    renderCalendar();
                });
            }
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const workoutExerciseSelect = document.getElementById('workout-exercise');
            if (workoutExerciseSelect) {
                workoutExerciseSelect.addEventListener('change', function() {
                    const exerciseId = parseInt(this.value);
                    if (exerciseId) {
                        currentSelectedExerciseId = exerciseId;
                        updateWorkoutFormFields();
                        loadExerciseHistory();
                    } else {
                        currentSelectedExerciseId = null;
                        hideExerciseIndicator();
                    }
                });
            }
            
            // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            const analyticsExerciseSelect = document.getElementById('analytics-exercise');
            if (analyticsExerciseSelect) {
                analyticsExerciseSelect.addEventListener('change', updateAnalytics);
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const closeModalBtn = document.getElementById('close-modal');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeExerciseModal);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function loadCategories() {
            const container = document.getElementById('categories-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            categories.forEach(category => {
                const categoryExercises = exercises.filter(exercise => exercise.category === category.id);
                
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                if (expandedCategories.has(category.id)) {
                    categoryCard.classList.add('expanded');
                }
                
                categoryCard.innerHTML = `
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${categoryExercises.length}</div>
                    <div class="category-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                `;
                
                categoryCard.addEventListener('click', (e) => {
                    // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Ä–∞—Å–∫—Ä—ã—Ç–∞ - —Å–∫—Ä—ã–≤–∞–µ–º
                    if (expandedCategories.has(category.id)) {
                        expandedCategories.delete(category.id);
                    } else {
                        // –ò–Ω–∞—á–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º
                        expandedCategories.clear();
                        expandedCategories.add(category.id);
                    }
                    
                    loadCategories();
                    e.stopPropagation();
                });
                
                container.appendChild(categoryCard);
                
                // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const exercisesContainer = document.createElement('div');
                exercisesContainer.id = `exercises-${category.id}`;
                exercisesContainer.className = 'category-exercises';
                if (expandedCategories.has(category.id)) {
                    exercisesContainer.classList.add('show');
                    showCategoryExercises(category.id, exercisesContainer);
                }
                container.appendChild(exercisesContainer);
            });
        }

        // –ü–æ–∫–∞–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showCategoryExercises(categoryId, container) {
            const categoryExercises = exercises.filter(exercise => exercise.category === categoryId);
            
            if (categoryExercises.length === 0) {
                container.innerHTML = '<div style="padding: 10px; color: #95a5a6; font-style: italic; text-align: center;">–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>';
                return;
            }
            
            container.innerHTML = '';
            
            categoryExercises.forEach(exercise => {
                const exerciseElement = document.createElement('div');
                exerciseElement.className = 'category-exercise-item';
                
                const latestWorkout = workouts
                    .filter(w => w.exerciseId === exercise.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                let statsText = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                if (latestWorkout) {
                    if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                        statsText = `–£—Ä–æ–≤–µ–Ω—å: ${latestWorkout.level || '0'}`;
                        if (latestWorkout.distance) {
                            statsText += `, ${latestWorkout.distance} –∫–º`;
                        }
                        if (latestWorkout.time) {
                            statsText += `, ${latestWorkout.time} –º–∏–Ω`;
                        }
                    } else {
                        statsText = `${latestWorkout.weight || '0'} –∫–≥ √ó ${latestWorkout.reps || '0'} / ${latestWorkout.sets || '0'}`;
                    }
                }
                
                exerciseElement.innerHTML = `
                    <div class="category-exercise-name">${exercise.name}</div>
                    <div class="category-exercise-stats">${statsText}</div>
                `;
                
                const moreBtn = document.createElement('button');
                moreBtn.className = 'more-btn';
                moreBtn.innerHTML = '‚ãØ';
                moreBtn.style.marginLeft = '8px';
                moreBtn.onclick = (e) => {
                    e.stopPropagation();
                    showExerciseMenuInCategory(e, exercise.id);
                };
                
                exerciseElement.appendChild(moreBtn);
                
                const dropdown = document.createElement('div');
                dropdown.className = 'dropdown-menu';
                dropdown.id = `category-dropdown-${exercise.id}`;
                dropdown.innerHTML = `
                    <button class="dropdown-item edit" onclick="openExerciseModal(${exercise.id})">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `;
                
                exerciseElement.appendChild(dropdown);
                
                exerciseElement.addEventListener('click', (e) => {
                    if (!e.target.closest('.more-btn')) {
                        openNewWorkoutWithExercise(exercise.id);
                    }
                });
                
                container.appendChild(exerciseElement);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showExerciseMenuInCategory(event, exerciseId) {
            event.stopPropagation();
            const dropdown = document.getElementById(`category-dropdown-${exerciseId}`);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –º–µ–Ω—é
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                if (menu !== dropdown) menu.classList.remove('show');
            });
            
            // –ï—Å–ª–∏ –º–µ–Ω—é —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ - –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∏–Ω–∞—á–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            } else {
                dropdown.classList.add('show');
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ–º
        function openNewWorkoutWithExercise(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            const workoutsTab = document.querySelector('.tab[data-tab="workouts"]');
            const workoutsTabContent = document.getElementById('workouts-tab');
            
            if (workoutsTab && workoutsTabContent) {
                workoutsTab.classList.add('active');
                workoutsTabContent.classList.add('active');
            }
            
            const workoutExerciseSelect = document.getElementById('workout-exercise');
            if (workoutExerciseSelect) {
                workoutExerciseSelect.value = exerciseId;
            }
            
            currentSelectedExerciseId = exerciseId;
            updateWorkoutFormFields();
            loadExerciseHistory();
            
            setTimeout(() => {
                const workoutFormCard = document.getElementById('workout-form-card');
                if (workoutFormCard) {
                    workoutFormCard.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function showExerciseIndicator(name, category) {
            const indicator = document.getElementById('selected-exercise-indicator');
            const nameElement = document.getElementById('selected-exercise-name');
            const categoryElement = document.getElementById('selected-exercise-category');
            
            if (indicator && nameElement && categoryElement) {
                nameElement.textContent = name;
                categoryElement.textContent = category;
                indicator.style.display = 'block';
            }
        }

        // –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function hideExerciseIndicator() {
            const indicator = document.getElementById('selected-exercise-indicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function updateWorkoutFormFields() {
            const exerciseId = currentSelectedExerciseId;
            let selectValue = null;
            
            const workoutExerciseSelect = document.getElementById('workout-exercise');
            if (workoutExerciseSelect) {
                selectValue = parseInt(workoutExerciseSelect.value);
            }
            
            const finalExerciseId = exerciseId || selectValue;
            const exercise = exercises.find(e => e.id === finalExerciseId);
            
            if (exercise) {
                showExerciseIndicator(exercise.name, exercise.category);
                
                const standardFields = document.getElementById('standard-fields');
                const cardioFields = document.getElementById('cardio-fields');
                
                if (standardFields && cardioFields) {
                    if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                        standardFields.classList.add('hidden-field');
                        cardioFields.classList.remove('hidden-field');
                    } else {
                        standardFields.classList.remove('hidden-field');
                        cardioFields.classList.add('hidden-field');
                    }
                }
            } else {
                hideExerciseIndicator();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function addExercise() {
            const nameInput = document.getElementById('exercise-name');
            const categorySelect = document.getElementById('exercise-category');
            const descriptionTextarea = document.getElementById('exercise-description');
            
            if (!nameInput || !categorySelect) return;
            
            const name = nameInput.value.trim();
            const category = categorySelect.value;
            const description = descriptionTextarea ? descriptionTextarea.value.trim() : '';
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            const exercise = {
                id: Date.now(),
                name: name,
                category: category,
                description: description,
                createdAt: new Date().toISOString()
            };
            
            exercises.push(exercise);
            localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
            
            loadCategories();
            updateExerciseDropdown();
            updateAnalyticsDropdown();
            updateStats();
            
            nameInput.value = '';
            if (descriptionTextarea) {
                descriptionTextarea.value = '';
            }
            
            expandedCategories.clear();
            expandedCategories.add(category);
            loadCategories();
            
            showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ', 'success');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ dropdown —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏
        function updateExerciseDropdown() {
            const select = document.getElementById('workout-exercise');
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>';
            exercises.forEach(ex => {
                select.innerHTML += `<option value="${ex.id}">${ex.name}</option>`;
            });
            
            if (currentSelectedExerciseId) {
                select.value = currentSelectedExerciseId;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ dropdown –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function updateAnalyticsDropdown() {
            const select = document.getElementById('analytics-exercise');
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</option>';
            exercises.forEach(ex => {
                select.innerHTML += `<option value="${ex.id}">${ex.name}</option>`;
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function addWorkout() {
            const exerciseId = currentSelectedExerciseId;
            let selectValue = null;
            
            const workoutExerciseSelect = document.getElementById('workout-exercise');
            if (workoutExerciseSelect) {
                selectValue = parseInt(workoutExerciseSelect.value);
            }
            
            const finalExerciseId = exerciseId || selectValue;
            const dateInput = document.getElementById('workout-date');
            
            if (!dateInput) return;
            
            const date = dateInput.value;
            
            if (!finalExerciseId || !date) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∏ –¥–∞—Ç—É', 'error');
                return;
            }
            
            const exercise = exercises.find(e => e.id === finalExerciseId);
            if (!exercise) {
                showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                return;
            }
            
            let workoutData = {
                id: Date.now(),
                exerciseId: finalExerciseId,
                exerciseName: exercise.name,
                exerciseCategory: exercise.category,
                date: date
            };
            
            if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                const levelInput = document.getElementById('level');
                const distanceInput = document.getElementById('distance');
                const timeInput = document.getElementById('time');
                const difficultyInput = document.getElementById('cardio-difficulty');
                
                // –£—Ä–æ–≤–µ–Ω—å —Ç–µ–ø–µ—Ä—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
                const level = levelInput ? parseFloat(levelInput.value) : null;
                const distance = distanceInput ? distanceInput.value.trim() : '';
                const time = timeInput ? timeInput.value.trim() : '';
                const difficulty = difficultyInput ? difficultyInput.value.trim() : '';
                
                workoutData.level = level;
                workoutData.distance = distance ? parseFloat(distance) : null;
                workoutData.time = time ? parseInt(time) : null;
                workoutData.difficulty = difficulty || '—Å—Ä–µ–¥–Ω–µ';
                workoutData.weight = 0;
                workoutData.reps = 0;
                workoutData.sets = 0;
            } else {
                const weightInput = document.getElementById('weight');
                const repsInput = document.getElementById('reps');
                const setsInput = document.getElementById('sets');
                const difficultyInput = document.getElementById('difficulty');
                
                if (!weightInput || !repsInput || !setsInput) return;
                
                const weight = parseFloat(weightInput.value);
                const reps = parseInt(repsInput.value);
                const sets = parseInt(setsInput.value);
                const difficulty = difficultyInput ? difficultyInput.value.trim() : '';
                
                if (isNaN(weight) || weight <= 0 || isNaN(reps) || reps <= 0 || isNaN(sets) || sets <= 0) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –í–µ—Å, –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏ –ü–æ–¥—Ö–æ–¥—ã', 'error');
                    return;
                }
                
                workoutData.weight = weight;
                workoutData.reps = reps;
                workoutData.sets = sets;
                workoutData.difficulty = difficulty || '—Å—Ä–µ–¥–Ω–µ';
                workoutData.level = 0;
                workoutData.distance = null;
                workoutData.time = null;
            }
            
            workouts.push(workoutData);
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            loadCategories();
            updateStats();
            renderCalendar();
            loadExerciseHistory();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            const inputsToClear = ['weight', 'reps', 'sets', 'level', 'distance', 'time', 'difficulty', 'cardio-difficulty'];
            inputsToClear.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '';
            });
            
            const selectedDayWorkouts = document.getElementById('selected-day-workouts');
            if (selectedDayWorkouts) {
                selectedDayWorkouts.innerHTML = '';
            }
            
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function loadExerciseHistory() {
            const container = document.getElementById('exercise-history-container');
            if (!container) return;
            
            const exerciseId = currentSelectedExerciseId;
            let selectValue = null;
            
            const workoutExerciseSelect = document.getElementById('workout-exercise');
            if (workoutExerciseSelect) {
                selectValue = parseInt(workoutExerciseSelect.value);
            }
            
            const finalExerciseId = exerciseId || selectValue;
            
            if (!finalExerciseId) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏</p>';
                return;
            }
            
            const exercise = exercises.find(e => e.id === finalExerciseId);
            if (!exercise) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }
            
            const exerciseWorkouts = workouts
                .filter(w => w.exerciseId === finalExerciseId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            if (exerciseWorkouts.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: #7f8c8d;">
                        –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è<br>
                        <strong>${exercise.name}</strong>
                    </p>
                `;
                return;
            }
            
            let html = `<div style="margin-bottom: 15px; font-weight: 600; color: #1a472a;">${exercise.name} - –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</div>`;
            
            exerciseWorkouts.forEach(workout => {
                const date = new Date(workout.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                html += `
                    <div class="compact-workout-card">
                        <div class="compact-workout-header">
                            <div class="compact-workout-name">${date}</div>
                            <button class="compact-workout-edit-btn" onclick="openEditWorkoutModal(${workout.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        
                        <div class="compact-workout-stats">
                `;
                
                if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                    html += `
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                            <div class="compact-workout-stat-value">${workout.level || '-'}</div>
                        </div>
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                            <div class="compact-workout-stat-value">${workout.distance ? workout.distance + ' –∫–º' : '-'}</div>
                        </div>
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–í—Ä–µ–º—è</div>
                            <div class="compact-workout-stat-value">${workout.time ? workout.time + ' –º–∏–Ω' : '-'}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–í–µ—Å</div>
                            <div class="compact-workout-stat-value">${workout.weight} –∫–≥</div>
                        </div>
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                            <div class="compact-workout-stat-value">${workout.reps}</div>
                        </div>
                        <div class="compact-workout-stat">
                            <div class="compact-workout-stat-label">–ü–æ–¥—Ö–æ–¥—ã</div>
                            <div class="compact-workout-stat-value">${workout.sets}</div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                        <div class="compact-workout-difficulty">${workout.difficulty || '—Å—Ä–µ–¥–Ω–µ'}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function openEditWorkoutModal(workoutId) {
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) return;
            
            const exercise = exercises.find(e => e.id === workout.exerciseId);
            if (!exercise) return;
            
            document.getElementById('edit-workout-id').value = workout.id;
            document.getElementById('edit-workout-category').value = exercise.category;
            document.getElementById('edit-workout-exercise-name').textContent = workout.exerciseName;
            document.getElementById('edit-workout-date').value = workout.date;
            
            if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                document.getElementById('edit-cardio-fields').classList.remove('hidden-field');
                document.getElementById('edit-standard-fields').classList.add('hidden-field');
                
                document.getElementById('edit-level').value = workout.level || '';
                document.getElementById('edit-distance').value = workout.distance || '';
                document.getElementById('edit-time').value = workout.time || '';
                document.getElementById('edit-cardio-difficulty').value = workout.difficulty || '';
            } else {
                document.getElementById('edit-standard-fields').classList.remove('hidden-field');
                document.getElementById('edit-cardio-fields').classList.add('hidden-field');
                
                document.getElementById('edit-weight').value = workout.weight || '';
                document.getElementById('edit-reps').value = workout.reps || '';
                document.getElementById('edit-sets').value = workout.sets || '';
                document.getElementById('edit-difficulty').value = workout.difficulty || '';
            }
            
            document.getElementById('edit-workout-modal').classList.add('active');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function closeEditWorkoutModal() {
            document.getElementById('edit-workout-modal').classList.remove('active');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function saveWorkoutChanges() {
            const workoutId = parseInt(document.getElementById('edit-workout-id').value);
            const category = document.getElementById('edit-workout-category').value;
            const date = document.getElementById('edit-workout-date').value;
            
            const index = workouts.findIndex(w => w.id === workoutId);
            if (index === -1) return;
            
            let workoutData = { ...workouts[index] };
            workoutData.date = date;
            
            if (category === '–ö–∞—Ä–¥–∏–æ') {
                const level = document.getElementById('edit-level').value;
                const distance = document.getElementById('edit-distance').value;
                const time = document.getElementById('edit-time').value;
                const difficulty = document.getElementById('edit-cardio-difficulty').value;
                
                workoutData.level = level ? parseFloat(level) : null;
                workoutData.distance = distance ? parseFloat(distance) : null;
                workoutData.time = time ? parseInt(time) : null;
                workoutData.difficulty = difficulty || '—Å—Ä–µ–¥–Ω–µ';
            } else {
                const weight = document.getElementById('edit-weight').value;
                const reps = document.getElementById('edit-reps').value;
                const sets = document.getElementById('edit-sets').value;
                const difficulty = document.getElementById('edit-difficulty').value;
                
                if (!weight || !reps || !sets) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                workoutData.weight = parseFloat(weight);
                workoutData.reps = parseInt(reps);
                workoutData.sets = parseInt(sets);
                workoutData.difficulty = difficulty || '—Å—Ä–µ–¥–Ω–µ';
            }
            
            workouts[index] = workoutData;
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            loadCategories();
            updateStats();
            renderCalendar();
            loadExerciseHistory();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
            if (selectedCalendarDate) {
                showDayWorkouts(selectedCalendarDate);
            }
            
            closeEditWorkoutModal();
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function deleteWorkout(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) {
                return;
            }
            
            workouts = workouts.filter(w => w.id !== id);
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            loadCategories();
            updateStats();
            renderCalendar();
            loadExerciseHistory();
            
            const selectedDayWorkouts = document.getElementById('selected-day-workouts');
            if (selectedDayWorkouts) {
                selectedDayWorkouts.innerHTML = '';
            }
            
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function openExerciseModal(id) {
            const exercise = exercises.find(e => e.id === id);
            
            if (exercise) {
                const modal = document.getElementById('exercise-modal');
                const editId = document.getElementById('edit-exercise-id');
                const editName = document.getElementById('edit-exercise-name');
                const editCategory = document.getElementById('edit-exercise-category');
                const editDescription = document.getElementById('edit-exercise-description');
                
                if (modal && editId && editName && editCategory) {
                    editId.value = exercise.id;
                    editName.value = exercise.name;
                    editCategory.value = exercise.category;
                    
                    if (editDescription) {
                        editDescription.value = exercise.description || '';
                    }
                    
                    modal.classList.add('active');
                }
                
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => menu.classList.remove('show'));
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function closeExerciseModal() {
            const modal = document.getElementById('exercise-modal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function saveExerciseChanges() {
            const editId = document.getElementById('edit-exercise-id');
            const editName = document.getElementById('edit-exercise-name');
            const editCategory = document.getElementById('edit-exercise-category');
            const editDescription = document.getElementById('edit-exercise-description');
            
            if (!editId || !editName || !editCategory) return;
            
            const id = parseInt(editId.value);
            const name = editName.value.trim();
            const category = editCategory.value;
            const description = editDescription ? editDescription.value.trim() : '';
            
            if (!name || !category) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }
            
            const index = exercises.findIndex(e => e.id === id);
            if (index !== -1) {
                exercises[index] = {
                    ...exercises[index],
                    name,
                    category,
                    description
                };
                
                workouts.forEach(workout => {
                    if (workout.exerciseId === id) {
                        workout.exerciseCategory = category;
                    }
                });
                
                localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
                localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
                
                loadCategories();
                updateExerciseDropdown();
                updateAnalyticsDropdown();
                updateStats();
                loadExerciseHistory();
                
                closeExerciseModal();
                showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function initCalendar() {
            renderCalendar();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const title = document.getElementById('calendar-title');
            
            if (!calendar || !title) return;
            
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            title.textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            let firstDayOfWeek = firstDay.getDay();
            if (firstDayOfWeek === 0) firstDayOfWeek = 6;
            else firstDayOfWeek--;
            
            const workoutDates = new Set();
            workouts.forEach(workout => {
                const date = new Date(workout.date);
                const dateString = formatDateForComparison(date);
                workoutDates.add(dateString);
            });
            
            calendar.innerHTML = '';
            
            const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            dayNames.forEach(dayName => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = dayName;
                calendar.appendChild(dayHeader);
            });
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendar.appendChild(emptyDay);
            }
            
            const daysInMonth = lastDay.getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDate = new Date(year, month, day);
                const dateString = formatDateForComparison(dayDate);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                dayElement.dataset.date = dateString;
                
                const hasWorkout = workoutDates.has(dateString);
                if (hasWorkout) {
                    dayElement.classList.add('has-workout');
                }
                
                if (selectedCalendarDate === dateString) {
                    dayElement.classList.add('selected');
                }
                
                dayElement.addEventListener('click', () => {
                    // –ï—Å–ª–∏ –¥–µ–Ω—å —É–∂–µ –≤—ã–±—Ä–∞–Ω - —Å–∫—Ä—ã–≤–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    if (selectedCalendarDate === dateString) {
                        dayElement.classList.remove('selected');
                        selectedCalendarDate = null;
                        document.getElementById('selected-day-workouts').innerHTML = '';
                    } else {
                        // –ò–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                        document.querySelectorAll('.calendar-day.selected').forEach(d => {
                            d.classList.remove('selected');
                        });
                        
                        dayElement.classList.add('selected');
                        selectedCalendarDate = dateString;
                        
                        showDayWorkouts(dateString);
                    }
                });
                
                calendar.appendChild(dayElement);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å
        function showDayWorkouts(date) {
            const container = document.getElementById('selected-day-workouts');
            if (!container) return;
            
            const dayWorkouts = workouts.filter(w => {
                const workoutDate = new Date(w.date);
                const workoutDateString = formatDateForComparison(workoutDate);
                return workoutDateString === date;
            });
            
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                weekday: 'long'
            });
            
            let html = `
                <div class="date-header">
                    <div class="date-title">${formattedDate}</div>
                    <div class="date-workout-count">${dayWorkouts.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                </div>
            `;
            
            // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–Ω—è
            const comment = dayComments[date] || '';
            html += `
                <div class="day-comment">
                    <div class="day-comment-header">
                        <div class="day-comment-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –¥–Ω—é</div>
                        <button class="day-comment-edit-btn" onclick="editDayComment('${date}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <div class="day-comment-text" id="day-comment-text-${date}">${comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}</div>
                    <textarea id="day-comment-edit-${date}" style="display: none; width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.9em; margin-top: 10px;" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...">${comment}</textarea>
                    <div id="day-comment-actions-${date}" style="display: none; margin-top: 10px; display: flex; gap: 10px;">
                        <button onclick="saveDayComment('${date}')" style="background: #27ae60; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="cancelDayComment('${date}')" style="background: #95a5a6; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            
            if (dayWorkouts.length === 0) {
                html += '<p style="text-align: center; color: #7f8c8d; padding: 20px;">–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</p>';
            } else {
                dayWorkouts.forEach(workout => {
                    const exercise = exercises.find(e => e.id === workout.exerciseId);
                    if (!exercise) return;
                    
                    html += `
                        <div class="compact-workout-card">
                            <div class="compact-workout-header">
                                <div class="compact-workout-name">${workout.exerciseName}</div>
                                <button class="compact-workout-edit-btn" onclick="openEditWorkoutModal(${workout.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            
                            <div class="compact-workout-stats">
                    `;
                    
                    if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                        html += `
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                                <div class="compact-workout-stat-value">${workout.level || '-'}</div>
                            </div>
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                <div class="compact-workout-stat-value">${workout.distance ? workout.distance + ' –∫–º' : '-'}</div>
                            </div>
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–í—Ä–µ–º—è</div>
                                <div class="compact-workout-stat-value">${workout.time ? workout.time + ' –º–∏–Ω' : '-'}</div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–í–µ—Å</div>
                                <div class="compact-workout-stat-value">${workout.weight} –∫–≥</div>
                            </div>
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                                <div class="compact-workout-stat-value">${workout.reps}</div>
                            </div>
                            <div class="compact-workout-stat">
                                <div class="compact-workout-stat-label">–ü–æ–¥—Ö–æ–¥—ã</div>
                                <div class="compact-workout-stat-value">${workout.sets}</div>
                            </div>
                        `;
                    }
                    
                    html += `
                            </div>
                            <div class="compact-workout-difficulty">${workout.difficulty || '—Å—Ä–µ–¥–Ω–µ'}</div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–Ω—è
        function editDayComment(date) {
            document.getElementById(`day-comment-text-${date}`).style.display = 'none';
            document.getElementById(`day-comment-edit-${date}`).style.display = 'block';
            document.getElementById(`day-comment-actions-${date}`).style.display = 'flex';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–Ω—è
        function saveDayComment(date) {
            const comment = document.getElementById(`day-comment-edit-${date}`).value.trim();
            dayComments[date] = comment;
            localStorage.setItem('workoutDiaryDayComments', JSON.stringify(dayComments));
            
            document.getElementById(`day-comment-text-${date}`).textContent = comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è';
            document.getElementById(`day-comment-text-${date}`).style.display = 'block';
            document.getElementById(`day-comment-edit-${date}`).style.display = 'none';
            document.getElementById(`day-comment-actions-${date}`).style.display = 'none';
            
            showNotification('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'success');
        }

        // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–Ω—è
        function cancelDayComment(date) {
            const originalComment = dayComments[date] || '';
            document.getElementById(`day-comment-text-${date}`).style.display = 'block';
            document.getElementById(`day-comment-edit-${date}`).style.display = 'none';
            document.getElementById(`day-comment-actions-${date}`).style.display = 'none';
            document.getElementById(`day-comment-edit-${date}`).value = originalComment;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            // 1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã)
            const totalWorkoutsElem = document.getElementById('total-workouts');
            if (totalWorkoutsElem) {
                const uniqueDates = new Set();
                workouts.forEach(workout => {
                    const date = new Date(workout.date);
                    const dateString = formatDateForComparison(date);
                    uniqueDates.add(dateString);
                });
                totalWorkoutsElem.textContent = uniqueDates.size;
            }
            
            // 2. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–Ω–∏)
            const thisMonthElem = document.getElementById('this-month');
            if (thisMonthElem) {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                const thisMonthWorkouts = workouts.filter(workout => {
                    const workoutDate = new Date(workout.date);
                    return workoutDate.getMonth() === currentMonth && 
                           workoutDate.getFullYear() === currentYear;
                });
                
                const uniqueThisMonthDates = new Set();
                thisMonthWorkouts.forEach(workout => {
                    const date = new Date(workout.date);
                    const dateString = formatDateForComparison(date);
                    uniqueThisMonthDates.add(dateString);
                });
                
                thisMonthElem.textContent = uniqueThisMonthDates.size;
            }
            
            // 3. –°—É–º–º–∞ –∫–∏–ª–æ–º–µ—Ç—Ä–æ–≤ –≤ –∫–∞—Ä–¥–∏–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
            const totalDistanceElem = document.getElementById('total-distance');
            if (totalDistanceElem) {
                const cardioWorkouts = workouts.filter(w => w.exerciseCategory === '–ö–∞—Ä–¥–∏–æ' && w.distance);
                const totalDistance = cardioWorkouts.reduce((sum, workout) => {
                    return sum + (workout.distance || 0);
                }, 0);
                totalDistanceElem.textContent = totalDistance.toFixed(1);
            }
            
            // 4-6. –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–í–µ—Å √ó –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è √ó –ü–æ–¥—Ö–æ–¥—ã)
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–Ω—è–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const workoutsByDateAndCategory = {};
            
            workouts.forEach(workout => {
                if (workout.exerciseCategory === '–ö–∞—Ä–¥–∏–æ' || !workout.weight || !workout.reps || !workout.sets) {
                    return;
                }
                
                const date = workout.date;
                const category = workout.exerciseCategory;
                const score = workout.weight * workout.reps * workout.sets;
                
                if (!workoutsByDateAndCategory[date]) {
                    workoutsByDateAndCategory[date] = {};
                }
                
                if (!workoutsByDateAndCategory[date][category]) {
                    workoutsByDateAndCategory[date][category] = 0;
                }
                
                workoutsByDateAndCategory[date][category] += score;
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            let bestArmsBack = { score: 0, date: null };
            let bestLegs = { score: 0, date: null };
            let bestChest = { score: 0, date: null };
            
            Object.keys(workoutsByDateAndCategory).forEach(date => {
                const categories = workoutsByDateAndCategory[date];
                
                if (categories['–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞'] > bestArmsBack.score) {
                    bestArmsBack = { score: categories['–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞'], date };
                }
                
                if (categories['–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã'] > bestLegs.score) {
                    bestLegs = { score: categories['–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã'], date };
                }
                
                if (categories['–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å'] > bestChest.score) {
                    bestChest = { score: categories['–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å'], date };
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            const bestArmsBackElem = document.getElementById('best-arms-back');
            const bestArmsBackDateElem = document.getElementById('best-arms-back-date');
            if (bestArmsBackElem && bestArmsBackDateElem) {
                bestArmsBackElem.textContent = bestArmsBack.score.toFixed(0);
                bestArmsBackDateElem.textContent = bestArmsBack.date ? formatDateCompact(bestArmsBack.date) : '-';
            }
            
            const bestLegsElem = document.getElementById('best-legs');
            const bestLegsDateElem = document.getElementById('best-legs-date');
            if (bestLegsElem && bestLegsDateElem) {
                bestLegsElem.textContent = bestLegs.score.toFixed(0);
                bestLegsDateElem.textContent = bestLegs.date ? formatDateCompact(bestLegs.date) : '-';
            }
            
            const bestChestElem = document.getElementById('best-chest');
            const bestChestDateElem = document.getElementById('best-chest-date');
            if (bestChestElem && bestChestDateElem) {
                bestChestElem.textContent = bestChest.score.toFixed(0);
                bestChestDateElem.textContent = bestChest.date ? formatDateCompact(bestChest.date) : '-';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function updateAnalytics() {
            const exerciseId = parseInt(document.getElementById('analytics-exercise').value);
            if (!exerciseId) {
                document.getElementById('progress-chart').innerHTML = `
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line" style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                    </div>
                `;
                return;
            }
            
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
            const exerciseWorkouts = workouts
                .filter(w => w.exerciseId === exerciseId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (exerciseWorkouts.length === 0) {
                document.getElementById('progress-chart').innerHTML = `
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line" style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            let chartHtml = '<div style="width: 100%; height: 100%; position: relative;">';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            let metricName = '';
            let metricValues = [];
            let dates = [];
            
            if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                metricName = '–£—Ä–æ–≤–µ–Ω—å';
                metricValues = exerciseWorkouts.map(w => w.level || 0);
            } else {
                metricName = '–í–µ—Å (–∫–≥)';
                metricValues = exerciseWorkouts.map(w => w.weight || 0);
            }
            
            dates = exerciseWorkouts.map(w => formatDateCompact(w.date));
            
            // –ù–∞—Ö–æ–¥–∏–º min –∏ max –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            const minValue = Math.min(...metricValues);
            const maxValue = Math.max(...metricValues);
            const range = maxValue - minValue || 1;
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            const chartHeight = 180;
            const chartWidth = dates.length * 40;
            const padding = 20;
            
            chartHtml += `<svg width="100%" height="100%" viewBox="0 0 ${Math.max(chartWidth, 300)} ${chartHeight + padding * 2}" style="overflow: visible;">`;
            
            // –û—Å–∏
            chartHtml += `<line x1="${padding}" y1="${chartHeight + padding}" x2="${Math.max(chartWidth, 300) - padding}" y2="${chartHeight + padding}" stroke="#ccc" stroke-width="1"/>`;
            
            // –õ–∏–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
            let pathData = '';
            
            metricValues.forEach((value, index) => {
                const x = padding + (index * 40);
                const y = padding + chartHeight - ((value - minValue) / range * chartHeight);
                
                if (index === 0) {
                    pathData = `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            });
            
            chartHtml += `<path d="${pathData}" fill="none" stroke="#27ae60" stroke-width="2"/>`;
            
            // –¢–æ—á–∫–∏
            metricValues.forEach((value, index) => {
                const x = padding + (index * 40);
                const y = padding + chartHeight - ((value - minValue) / range * chartHeight);
                
                chartHtml += `<circle cx="${x}" cy="${y}" r="4" fill="#27ae60"/>`;
                chartHtml += `<text x="${x}" y="${y - 10}" text-anchor="middle" font-size="10" fill="#27ae60">${value}</text>`;
                chartHtml += `<text x="${x}" y="${chartHeight + padding + 15}" text-anchor="middle" font-size="10" fill="#7f8c8d">${dates[index]}</text>`;
            });
            
            chartHtml += '</svg></div>';
            
            document.getElementById('progress-chart').innerHTML = chartHtml;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function createBackup() {
            try {
                const backupData = {
                    exercises: exercises,
                    workouts: workouts,
                    dayComments: dayComments,
                    backupDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                localStorage.setItem('workoutDiaryBackupData', JSON.stringify(backupData));
                
                backupSettings.lastBackup = new Date().toISOString();
                backupSettings.reminderShown = true;
                localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                
                updateBackupInfo();
                
                showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', 'error');
            }
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function restoreBackup() {
            try {
                const backupData = localStorage.getItem('workoutDiaryBackupData');
                
                if (!backupData) {
                    showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                if (!confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
                    return;
                }
                
                const data = JSON.parse(backupData);
                
                exercises = data.exercises || [];
                workouts = data.workouts || [];
                dayComments = data.dayComments || {};
                
                localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
                localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
                localStorage.setItem('workoutDiaryDayComments', JSON.stringify(dayComments));
                
                loadCategories();
                updateExerciseDropdown();
                updateAnalyticsDropdown();
                updateStats();
                renderCalendar();
                loadExerciseHistory();
                
                showNotification('–î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function updateBackupInfo() {
            const backupInfo = document.getElementById('backup-info');
            if (!backupInfo) return;
            
            if (backupSettings.lastBackup) {
                const lastBackupDate = new Date(backupSettings.lastBackup);
                const formattedDate = lastBackupDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                backupInfo.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: ${formattedDate}`;
            } else {
                backupInfo.textContent = '–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
        function checkBackupReminder() {
            if (backupSettings.lastBackup) {
                const lastBackupDate = new Date(backupSettings.lastBackup);
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                if (lastBackupDate < oneWeekAgo && !backupSettings.reminderShown) {
                    setTimeout(() => {
                        if (confirm('–ü—Ä–æ—à–ª–∞ –Ω–µ–¥–µ–ª—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Å–µ–π—á–∞—Å?')) {
                            createBackup();
                        } else {
                            backupSettings.reminderShown = true;
                            localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                        }
                    }, 2000);
                }
            } else if (!backupSettings.reminderShown) {
                setTimeout(() => {
                    if (confirm('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞—Ç—å —Å–µ–π—á–∞—Å?')) {
                        createBackup();
                    } else {
                        backupSettings.reminderShown = true;
                        localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                    }
                }, 2000);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        if (exercises.length === 0) {
            exercises = [
                { id: 1, name: '–ë–µ–≥ –Ω–∞ –¥–æ—Ä–æ–∂–∫–µ', category: '–ö–∞—Ä–¥–∏–æ', description: '–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞', createdAt: new Date().toISOString() },
                { id: 2, name: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π', category: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', description: '–ë–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', createdAt: new Date().toISOString() },
                { id: 3, name: '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞', category: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', description: '–ñ–∏–º –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∫–∞–º—å–µ', createdAt: new Date().toISOString() },
                { id: 4, name: '–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞', category: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', description: '–¢—è–≥–∞ –∫ –≥—Ä—É–¥–∏', createdAt: new Date().toISOString() }
            ];
            localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
            
            loadCategories();
            updateExerciseDropdown();
            updateAnalyticsDropdown();
            updateStats();
        }
    </script>
</body>
</html>
