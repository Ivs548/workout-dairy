<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üèãÔ∏è –î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f0f9f0 0%, #d1f2d1 100%);
            color: #1a472a;
            padding: 10px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .header h1 {
            font-size: 1.5em;
            color: #1a472a;
            margin-bottom: 15px;
        }
        
        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π - —É–∑–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .categories-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .category-card {
            background: white;
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .category-card.active {
            border-left-color: #27ae60;
            background: #eafaf1;
        }
        
        .category-card.expanded {
            margin-bottom: 0;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .category-icon {
            font-size: 1.2em;
            color: #27ae60;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        
        .category-name {
            font-size: 0.9em;
            font-weight: 600;
            flex-grow: 1;
        }
        
        .category-count {
            font-size: 0.8em;
            color: #7f8c8d;
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .category-arrow {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-left: 8px;
            transition: transform 0.3s;
        }
        
        .category-card.expanded .category-arrow {
            transform: rotate(180deg);
        }
        
        /* –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-exercises {
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            margin-top: -2px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .category-exercises.show {
            display: flex;
        }
        
        .category-exercise-item {
            background: white;
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid #27ae60;
        }
        
        .category-exercise-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .category-exercise-name {
            font-size: 0.9em;
            font-weight: 500;
            flex-grow: 1;
        }
        
        .category-exercise-stats {
            font-size: 0.8em;
            color: #7f8c8d;
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar-section {
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-title {
            font-weight: 600;
            font-size: 1em;
        }
        
        .calendar-arrow {
            background: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: #27ae60;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .calendar-header {
            text-align: center;
            font-size: 0.8em;
            color: #7f8c8d;
            padding: 5px 0;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day.has-workout {
            background: #27ae60;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background: #2ecc71;
            color: white;
            box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.3);
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            background: white;
            padding: 8px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .tab {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            border: none;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .exercises-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è */
        .exercise-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #27ae60;
        }
        
        .exercise-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .exercise-name {
            font-weight: 600;
            font-size: 1em;
            flex-grow: 1;
            padding-right: 10px;
        }
        
        .more-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .more-btn:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 40px;
            right: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 100px;
            display: none;
            overflow: hidden;
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            border: none;
            width: 100%;
            background: none;
            font-size: 0.9em;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .dropdown-item.edit {
            color: #27ae60;
        }
        
        .dropdown-item.delete {
            color: #e74c3c;
        }
        
        .exercise-stats {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        
        .progress-chart {
            height: 20px;
            position: relative;
            margin-top: 8px;
        }
        
        .chart-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #27ae60;
            transform: translateY(-50%);
        }
        
        .chart-point {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #2ecc71;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
        }
        
        /* –§–æ—Ä–º—ã */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .form-card h2 {
            margin-bottom: 15px;
            color: #1a472a;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #27ae60;
            outline: none;
        }
        
        .cardio-inputs, .standard-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .hidden-field {
            display: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
        .workout-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 8px 0;
            position: relative;
            border-left: 4px solid #27ae60;
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .workout-date {
            font-weight: 600;
            color: #1a472a;
        }
        
        .workout-more-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .workout-dropdown-menu {
            position: absolute;
            top: 40px;
            right: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 100px;
            display: none;
            overflow: hidden;
        }
        
        .workout-dropdown-menu.show {
            display: block;
        }
        
        .workout-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-weight: 600;
            font-size: 1.1em;
            color: #1a472a;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card-compact {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-value-compact {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 5px;
        }
        
        .stat-label-compact {
            font-size: 0.85em;
            color: #7f8c8d;
        }
        
        .stat-date {
            font-size: 0.75em;
            color: #95a5a6;
            margin-top: 3px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            flex: 1;
        }
        
        /* –î–µ–Ω—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ */
        .day-workouts {
            margin-top: 15px;
        }
        
        .date-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-title {
            font-size: 1em;
            font-weight: bold;
        }
        
        .date-workout-count {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        /* –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ */
        .backup-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .backup-section h3 {
            margin-bottom: 15px;
            color: #1a472a;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .backup-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn-backup {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 14px;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-backup:hover {
            background: #eafaf1;
            border-color: #27ae60;
        }
        
        .btn-backup.save {
            color: #27ae60;
        }
        
        .btn-backup.restore {
            color: #3498db;
        }
        
        .backup-info {
            margin-top: 10px;
            font-size: 0.85em;
            color: #7f8c8d;
            text-align: center;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            border-left: 4px solid #27ae60;
        }
        
        .notification.error {
            border-left: 4px solid #e74c3c;
        }
        
        .notification.info {
            border-left: 4px solid #3498db;
        }
        
        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .exercise-history-chart {
            height: 60px;
            position: relative;
            margin-top: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            padding: 5px;
        }
        
        .history-chart-line {
            position: absolute;
            top: 50%;
            left: 5px;
            right: 5px;
            height: 2px;
            background: #27ae60;
            transform: translateY(-50%);
        }
        
        .history-chart-point {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #2ecc71;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .exercises-list {
                grid-template-columns: 1fr;
            }
            
            .calendar {
                gap: 2px;
                padding: 8px;
            }
            
            .cardio-inputs, .standard-inputs {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .backup-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .tab {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>üèãÔ∏è –î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
    </div>
    
    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π - —É–∑–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Å—Ç–æ–ª–±–∏–∫ -->
    <div id="categories-container" class="categories-grid"></div>
    
    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div class="calendar-section">
        <div class="calendar-nav">
            <button class="calendar-arrow" id="prev-month">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="calendar-title" id="calendar-title"></div>
            <button class="calendar-arrow" id="next-month">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <div class="calendar" id="calendar"></div>
    </div>
    
    <!-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è -->
    <div id="selected-day-workouts" class="day-workouts"></div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="tabs">
        <button class="tab active" data-tab="home" title="–ì–ª–∞–≤–Ω–∞—è">
            <i class="fas fa-home"></i>
        </button>
        <button class="tab" data-tab="exercises" title="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è">
            <i class="fas fa-dumbbell"></i>
        </button>
        <button class="tab" data-tab="workouts" title="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
            <i class="fas fa-running"></i>
        </button>
        <button class="tab" data-tab="stats" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
            <i class="fas fa-chart-line"></i>
        </button>
    </div>
    
    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div class="tab-content active" id="home-tab">
        <div id="home-content"></div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
    <div class="tab-content" id="exercises-tab">
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div class="form-card">
            <h2><i class="fas fa-plus-circle"></i> –ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
            <div class="form-group">
                <input type="text" id="exercise-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è">
            </div>
            <div class="form-group">
                <select id="exercise-category">
                    <option value="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</option>
                    <option value="–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã">–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã</option>
                    <option value="–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞">–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞</option>
                    <option value="–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å">–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å</option>
                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            <div class="form-group">
                <textarea id="exercise-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
            </div>
            <button onclick="addExercise()" class="btn-primary">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            </button>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
        <div id="exercises-list-container"></div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
    <div class="tab-content" id="workouts-tab">
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div class="form-card" id="workout-form-card">
            <h2><i class="fas fa-running"></i> –ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
            <div class="form-group">
                <select id="workout-exercise">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                </select>
            </div>
            <div class="form-group">
                <input type="date" id="workout-date">
            </div>
            
            <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è -->
            <div id="standard-fields" class="standard-inputs">
                <div class="form-group">
                    <input type="number" id="weight" placeholder="–í–µ—Å (–∫–≥)" step="0.5">
                </div>
                <div class="form-group">
                    <input type="number" id="reps" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" min="1">
                </div>
                <div class="form-group">
                    <input type="number" id="sets" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1">
                </div>
            </div>
            
            <!-- –ü–æ–ª—è –¥–ª—è –∫–∞—Ä–¥–∏–æ -->
            <div id="cardio-fields" class="cardio-inputs hidden-field">
                <div class="form-group">
                    <input type="number" id="level" placeholder="–£—Ä–æ–≤–µ–Ω—å" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <input type="number" id="distance" placeholder="–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <input type="text" disabled placeholder="-" style="visibility: hidden;">
                </div>
            </div>
            
            <div class="form-group">
                <input type="text" id="difficulty" placeholder="–°–ª–æ–∂–Ω–æ—Å—Ç—å (–ª–µ–≥–∫–æ/—Å—Ä–µ–¥–Ω–µ/—Ç—è–∂–µ–ª–æ)">
            </div>
            <div class="form-group">
                <textarea id="notes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
            </div>
            <button onclick="addWorkout()" class="btn-primary">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </div>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
        <div class="form-card">
            <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
            <div id="workouts-list"></div>
        </div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="tab-content" id="stats-tab">
        <div class="form-card">
            <h2><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            
            <div class="stats-grid">
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="total-exercises">0</div>
                    <div class="stat-label-compact">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="total-workouts">0</div>
                    <div class="stat-label-compact">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="best-weight">0</div>
                    <div class="stat-label-compact">–õ—É—á—à–∏–π –≤–µ—Å (–∫–≥)</div>
                    <div class="stat-date" id="best-weight-date">-</div>
                </div>
                <div class="stat-card-compact">
                    <div class="stat-value-compact" id="last-workout">-</div>
                    <div class="stat-label-compact">–ü–æ—Å–ª–µ–¥–Ω—è—è</div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; font-size: 1.1em;">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º</h3>
                <canvas id="progressChart" height="150"></canvas>
            </div>
        </div>
    </div>
    
    <!-- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="backup-section">
        <h3><i class="fas fa-database"></i> –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        <div class="backup-buttons">
            <button onclick="createBackup()" class="btn-backup save">
                <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
            </button>
            <button onclick="restoreBackup()" class="btn-backup restore">
                <i class="fas fa-history"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
        <div class="backup-info" id="backup-info">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="exercise-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="edit-exercise-form">
                <input type="hidden" id="edit-exercise-id">
                <div class="form-group">
                    <input type="text" id="edit-exercise-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                <div class="form-group">
                    <select id="edit-exercise-category" required>
                        <option value="–ö–∞—Ä–¥–∏–æ">–ö–∞—Ä–¥–∏–æ</option>
                        <option value="–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã">–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã</option>
                        <option value="–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞">–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞</option>
                        <option value="–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å">–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å</option>
                        <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="edit-exercise-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeExerciseModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let exercises = JSON.parse(localStorage.getItem('workoutDiaryExercises')) || [];
        let workouts = JSON.parse(localStorage.getItem('workoutDiaryWorkouts')) || [];
        let selectedExerciseId = null;
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;
        let activeDropdown = null;
        let activeWorkoutDropdown = null;
        let selectedCategory = null;
        let expandedCategories = new Set();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        const backupSettings = JSON.parse(localStorage.getItem('workoutDiaryBackup')) || {
            lastBackup: null,
            reminderShown: false
        };

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
        const categories = [
            { id: '–ö–∞—Ä–¥–∏–æ', name: '–ö–∞—Ä–¥–∏–æ', icon: 'fa-heart-pulse' },
            { id: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', name: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', icon: 'fa-person-running' },
            { id: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', name: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', icon: 'fa-dumbbell' },
            { id: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', name: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', icon: 'fa-user' },
            { id: '–î—Ä—É–≥–æ–µ', name: '–î—Ä—É–≥–æ–µ', icon: 'fa-ellipsis' }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
            const today = new Date();
            const todayString = formatDateForInput(today);
            document.getElementById('workout-date').value = todayString;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadCategories();
            loadExercises();
            loadWorkouts();
            updateStats();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            initCalendar();
            updateExerciseDropdown();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
            checkBackupReminder();
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
            updateBackupInfo();
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', (e) => {
                if (activeDropdown && !e.target.closest('.dropdown-menu') && !e.target.closest('.more-btn')) {
                    activeDropdown.classList.remove('show');
                    activeDropdown = null;
                }
                if (activeWorkoutDropdown && !e.target.closest('.workout-dropdown-menu') && !e.target.closest('.workout-more-btn')) {
                    activeWorkoutDropdown.classList.remove('show');
                    activeWorkoutDropdown = null;
                }
            });
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è input type="date"
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è)
        function formatDateForComparison(date) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
            const moscowDate = new Date(date.getTime() + (3 * 60 * 60 * 1000));
            const year = moscowDate.getUTCFullYear();
            const month = String(moscowDate.getUTCMonth() + 1).padStart(2, '0');
            const day = String(moscowDate.getUTCDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ –≥–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—É—é
                    if (tabId === 'home') {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                        
                        this.classList.add('active');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
                        document.querySelector('.calendar-section').style.display = 'block';
                        document.querySelector('.tabs').style.display = 'flex';
                        document.querySelector('.backup-section').style.display = 'block';
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                        document.getElementById('home-content').innerHTML = '';
                        
                    } else {
                        // –î–ª—è –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –∫–æ–Ω—Ç–µ–Ω—Ç
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                        
                        this.classList.add('active');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                        document.querySelector('.calendar-section').style.display = 'none';
                        document.getElementById('selected-day-workouts').innerHTML = '';
                    }
                });
            });
            
            // –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            document.getElementById('edit-exercise-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveExerciseChanges();
            });
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            document.getElementById('prev-month').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('next-month').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                renderCalendar();
            });
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ñ–æ—Ä–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            document.getElementById('workout-exercise').addEventListener('change', function() {
                updateWorkoutFormFields();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('close-modal').addEventListener('click', closeExerciseModal);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function loadCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const categoryExercises = exercises.filter(exercise => exercise.category === category.id);
                
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                if (selectedCategory === category.id) {
                    categoryCard.classList.add('active');
                }
                if (expandedCategories.has(category.id)) {
                    categoryCard.classList.add('expanded');
                }
                
                categoryCard.innerHTML = `
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${categoryExercises.length}</div>
                    <div class="category-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                `;
                
                categoryCard.addEventListener('click', (e) => {
                    if (e.target.closest('.more-btn')) return;
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    if (expandedCategories.has(category.id)) {
                        expandedCategories.delete(category.id);
                        categoryCard.classList.remove('expanded');
                        // –°–∫—Ä—ã–≤–∞–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        const exercisesContainer = document.getElementById(`exercises-${category.id}`);
                        if (exercisesContainer) {
                            exercisesContainer.classList.remove('show');
                        }
                    } else {
                        // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        expandedCategories.clear();
                        document.querySelectorAll('.category-card').forEach(card => {
                            card.classList.remove('expanded');
                        });
                        document.querySelectorAll('.category-exercises').forEach(container => {
                            container.classList.remove('show');
                        });
                        
                        expandedCategories.add(category.id);
                        categoryCard.classList.add('expanded');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        showCategoryExercises(category.id);
                    }
                });
                
                container.appendChild(categoryCard);
                
                // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const exercisesContainer = document.createElement('div');
                exercisesContainer.id = `exercises-${category.id}`;
                exercisesContainer.className = 'category-exercises';
                if (expandedCategories.has(category.id)) {
                    exercisesContainer.classList.add('show');
                }
                container.appendChild(exercisesContainer);
                
                // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                if (expandedCategories.has(category.id)) {
                    showCategoryExercises(category.id);
                }
            });
        }

        // –ü–æ–∫–∞–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showCategoryExercises(categoryId) {
            const container = document.getElementById(`exercises-${categoryId}`);
            const categoryExercises = exercises.filter(exercise => exercise.category === categoryId);
            
            if (categoryExercises.length === 0) {
                container.innerHTML = '<div style="padding: 10px; color: #95a5a6; font-style: italic; text-align: center;">–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>';
                return;
            }
            
            container.innerHTML = '';
            
            categoryExercises.forEach(exercise => {
                const exerciseElement = document.createElement('div');
                exerciseElement.className = 'category-exercise-item';
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                const exerciseWorkouts = workouts
                    .filter(w => w.exerciseId === exercise.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 7);
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                const latestWorkout = exerciseWorkouts[0];
                
                // –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                let statsText = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                if (latestWorkout) {
                    if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                        statsText = `–£—Ä–æ–≤–µ–Ω—å: ${latestWorkout.level || '0'}, –î–∏—Å—Ç–∞–Ω—Ü–∏—è: ${latestWorkout.distance || '0'} –∫–º`;
                    } else {
                        statsText = `${latestWorkout.weight || '0'} –∫–≥ √ó ${latestWorkout.reps || '0'} / ${latestWorkout.sets || '0'}`;
                    }
                }
                
                exerciseElement.innerHTML = `
                    <div class="category-exercise-name">${exercise.name}</div>
                    <div class="category-exercise-stats">${statsText}</div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–Ω—é —Å —Ç—Ä–µ–º—è —Ç–æ—á–∫–∞–º–∏
                const moreBtn = document.createElement('button');
                moreBtn.className = 'more-btn';
                moreBtn.innerHTML = '‚ãØ';
                moreBtn.style.marginLeft = '8px';
                moreBtn.onclick = (e) => {
                    e.stopPropagation();
                    showExerciseMenuInCategory(e, exercise.id);
                };
                
                exerciseElement.appendChild(moreBtn);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
                const dropdown = document.createElement('div');
                dropdown.className = 'dropdown-menu';
                dropdown.id = `category-dropdown-${exercise.id}`;
                dropdown.innerHTML = `
                    <button class="dropdown-item edit" onclick="openExerciseModal(${exercise.id})">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `;
                
                exerciseElement.appendChild(dropdown);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                exerciseElement.addEventListener('click', (e) => {
                    if (!e.target.closest('.more-btn')) {
                        openNewWorkoutWithExercise(exercise.id);
                    }
                });
                
                container.appendChild(exerciseElement);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                if (exerciseWorkouts.length >= 2) {
                    const chartContainer = document.createElement('div');
                    chartContainer.className = 'exercise-history-chart';
                    chartContainer.innerHTML = createProgressChartForCategory(exercise.id, exercise.category, exerciseWorkouts);
                    container.appendChild(chartContainer);
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showExerciseMenuInCategory(event, exerciseId) {
            event.stopPropagation();
            const dropdown = document.getElementById(`category-dropdown-${exerciseId}`);
            
            if (activeDropdown && activeDropdown !== dropdown) {
                activeDropdown.classList.remove('show');
            }
            
            dropdown.classList.toggle('show');
            activeDropdown = dropdown.classList.contains('show') ? dropdown : null;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function createProgressChartForCategory(exerciseId, category, exerciseWorkouts) {
            if (exerciseWorkouts.length < 2) {
                return '';
            }
            
            let values;
            if (category === '–ö–∞—Ä–¥–∏–æ') {
                values = exerciseWorkouts.map(w => parseFloat(w.level) || 0);
            } else {
                values = exerciseWorkouts.map(w => w.weight || 0);
            }
            
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);
            const range = maxValue - minValue;
            
            let chartHTML = '<div class="history-chart-line"></div>';
            
            exerciseWorkouts.forEach((workout, index) => {
                let chartValue;
                if (category === '–ö–∞—Ä–¥–∏–æ') {
                    chartValue = parseFloat(workout.level) || 0;
                } else {
                    chartValue = workout.weight || 0;
                }
                
                const normalizedValue = range > 0 ? (chartValue - minValue) / range : 0.5;
                const xPosition = 5 + (index / (exerciseWorkouts.length - 1)) * 90;
                const yPosition = 50 - (normalizedValue * 40);
                
                chartHTML += `<div class="history-chart-point" style="left: ${xPosition}%; top: ${yPosition}%;"></div>`;
            });
            
            return chartHTML;
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ–º
        function openNewWorkoutWithExercise(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            document.querySelector('.tab[data-tab="workouts"]').classList.add('active');
            document.getElementById('workouts-tab').classList.add('active');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            document.getElementById('workout-exercise').value = exerciseId;
            updateWorkoutFormFields();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
            document.getElementById('workout-form-card').scrollIntoView({ behavior: 'smooth' });
            
            showNotification(`–í—ã–±—Ä–∞–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: ${exercise.name}`, 'info');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function updateWorkoutFormFields() {
            const exerciseId = parseInt(document.getElementById('workout-exercise').value);
            const exercise = exercises.find(e => e.id === exerciseId);
            
            if (exercise) {
                if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                    document.getElementById('standard-fields').classList.add('hidden-field');
                    document.getElementById('cardio-fields').classList.remove('hidden-field');
                } else {
                    document.getElementById('standard-fields').classList.remove('hidden-field');
                    document.getElementById('cardio-fields').classList.add('hidden-field');
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function loadExercises() {
            const container = document.getElementById('exercises-list-container');
            
            if (exercises.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-dumbbell"></i>
                        <p>–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="exercises-list">';
            
            exercises.forEach(exercise => {
                const latestWorkout = workouts
                    .filter(w => w.exerciseId === exercise.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                html += `
                    <div class="exercise-card" onclick="openNewWorkoutWithExercise(${exercise.id})">
                        <div class="exercise-header">
                            <div class="exercise-name">${exercise.name}</div>
                            <button class="more-btn" onclick="showExerciseMenu(event, ${exercise.id})">‚ãØ</button>
                        </div>
                        
                        <div class="category-badge" style="font-size: 0.8em; color: #7f8c8d; margin-bottom: 8px;">
                            ${exercise.category}
                        </div>
                        
                        ${latestWorkout ? `
                            <div class="exercise-stats">
                                ${exercise.category === '–ö–∞—Ä–¥–∏–æ' ? 
                                    `–£—Ä–æ–≤–µ–Ω—å: ${latestWorkout.level || '0'}, –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${latestWorkout.distance || '0'} –∫–º` : 
                                    `${latestWorkout.weight || '0'} –∫–≥ √ó ${latestWorkout.reps || '0'} / ${latestWorkout.sets || '0'}`
                                }
                            </div>
                            ${createProgressChart(exercise.id, exercise.category)}
                        ` : `
                            <div class="exercise-stats" style="color: #95a5a6; font-style: italic;">
                                –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
                            </div>
                        `}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function showExerciseMenu(event, exerciseId) {
            event.stopPropagation();
            const dropdown = document.getElementById(`dropdown-${exerciseId}`);
            
            if (activeDropdown && activeDropdown !== dropdown) {
                activeDropdown.classList.remove('show');
            }
            
            dropdown.classList.toggle('show');
            activeDropdown = dropdown.classList.contains('show') ? dropdown : null;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function addExercise() {
            const name = document.getElementById('exercise-name').value.trim();
            const category = document.getElementById('exercise-category').value;
            const description = document.getElementById('exercise-description').value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            const exercise = {
                id: Date.now(),
                name: name,
                category: category,
                description: description,
                createdAt: new Date().toISOString()
            };
            
            exercises.push(exercise);
            localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            loadCategories();
            loadExercises();
            updateExerciseDropdown();
            updateStats();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('exercise-name').value = '';
            document.getElementById('exercise-description').value = '';
            
            // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –≤ –∫–æ—Ç–æ—Ä—É—é –¥–æ–±–∞–≤–∏–ª–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            expandedCategories.clear();
            expandedCategories.add(category);
            loadCategories();
            
            showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ', 'success');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ dropdown —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏
        function updateExerciseDropdown() {
            const select = document.getElementById('workout-exercise');
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>';
            exercises.forEach(ex => {
                select.innerHTML += `<option value="${ex.id}">${ex.name}</option>`;
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function addWorkout() {
            const exerciseId = parseInt(document.getElementById('workout-exercise').value);
            const date = document.getElementById('workout-date').value;
            const difficulty = document.getElementById('difficulty').value.trim();
            const notes = document.getElementById('notes').value.trim();
            
            if (!exerciseId || !date) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) {
                showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                return;
            }
            
            let workoutData = {
                id: Date.now(),
                exerciseId: exerciseId,
                exerciseName: exercise.name,
                exerciseCategory: exercise.category,
                date: date,
                difficulty: difficulty,
                notes: notes
            };
            
            if (exercise.category === '–ö–∞—Ä–¥–∏–æ') {
                const level = parseFloat(document.getElementById('level').value);
                const distance = parseFloat(document.getElementById('distance').value);
                
                if (isNaN(level) || isNaN(distance)) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –£—Ä–æ–≤–µ–Ω—å –∏ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ', 'error');
                    return;
                }
                
                workoutData.level = level;
                workoutData.distance = distance;
                workoutData.weight = 0;
                workoutData.reps = 0;
                workoutData.sets = 0;
            } else {
                const weight = parseFloat(document.getElementById('weight').value);
                const reps = parseInt(document.getElementById('reps').value);
                const sets = parseInt(document.getElementById('sets').value);
                
                if (isNaN(weight) || isNaN(reps) || isNaN(sets)) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –í–µ—Å, –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏ –ü–æ–¥—Ö–æ–¥—ã', 'error');
                    return;
                }
                
                workoutData.weight = weight;
                workoutData.reps = reps;
                workoutData.sets = sets;
                workoutData.level = 0;
                workoutData.distance = 0;
            }
            
            workouts.push(workoutData);
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            loadWorkouts();
            loadExercises();
            loadCategories();
            updateStats();
            renderCalendar();
            updateChart();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('weight').value = '';
            document.getElementById('reps').value = '';
            document.getElementById('sets').value = '';
            document.getElementById('level').value = '';
            document.getElementById('distance').value = '';
            document.getElementById('difficulty').value = '';
            document.getElementById('notes').value = '';
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –¥–Ω—è, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            document.getElementById('selected-day-workouts').innerHTML = '';
            
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        function loadWorkouts() {
            const container = document.getElementById('workouts-list');
            const sortedWorkouts = [...workouts].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sortedWorkouts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</p>';
                return;
            }
            
            container.innerHTML = sortedWorkouts.map(workout => {
                const date = new Date(workout.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                return `
                    <div class="workout-item">
                        <div class="workout-header">
                            <div class="workout-date">${date}</div>
                            <button class="workout-more-btn" onclick="showWorkoutMenu(event, ${workout.id})">‚ãØ</button>
                            <div class="workout-dropdown-menu" id="workout-dropdown-${workout.id}">
                                <button class="dropdown-item edit" onclick="editWorkout(${workout.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="dropdown-item delete" onclick="deleteWorkout(${workout.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 10px; font-weight: 600;">${workout.exerciseName}</div>
                        
                        <div class="workout-stats">
                            ${workout.exerciseCategory === '–ö–∞—Ä–¥–∏–æ' ? `
                                <div class="stat">
                                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                                    <div class="stat-value">${workout.level || '0'}</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="stat-value">${workout.distance || '0'} –∫–º</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–¢–∏–ø</div>
                                    <div class="stat-value">–ö–∞—Ä–¥–∏–æ</div>
                                </div>
                            ` : `
                                <div class="stat">
                                    <div class="stat-label">–í–µ—Å</div>
                                    <div class="stat-value">${workout.weight} –∫–≥</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                                    <div class="stat-value">${workout.reps}</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–ü–æ–¥—Ö–æ–¥—ã</div>
                                    <div class="stat-value">${workout.sets}</div>
                                </div>
                            `}
                        </div>
                        
                        ${workout.difficulty ? `<div style="margin-top: 10px; color: #7f8c8d;">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ${workout.difficulty}</div>` : ''}
                        ${workout.notes ? `<div style="margin-top: 5px; color: #7f8c8d; font-style: italic;">${workout.notes}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function showWorkoutMenu(event, workoutId) {
            event.stopPropagation();
            const dropdown = document.getElementById(`workout-dropdown-${workoutId}`);
            
            if (activeWorkoutDropdown && activeWorkoutDropdown !== dropdown) {
                activeWorkoutDropdown.classList.remove('show');
            }
            
            dropdown.classList.toggle('show');
            activeWorkoutDropdown = dropdown.classList.contains('show') ? dropdown : null;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function deleteExercise(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                return;
            }
            
            exercises = exercises.filter(e => e.id !== id);
            workouts = workouts.filter(w => w.exerciseId !== id);
            
            localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            loadCategories();
            loadExercises();
            updateExerciseDropdown();
            updateStats();
            renderCalendar();
            updateChart();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            if (activeDropdown) {
                activeDropdown.classList.remove('show');
                activeDropdown = null;
            }
            
            showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function deleteWorkout(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) {
                return;
            }
            
            workouts = workouts.filter(w => w.id !== id);
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            loadWorkouts();
            loadCategories();
            loadExercises();
            updateStats();
            renderCalendar();
            updateChart();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –¥–Ω—è, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            document.getElementById('selected-day-workouts').innerHTML = '';
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            if (activeWorkoutDropdown) {
                activeWorkoutDropdown.classList.remove('show');
                activeWorkoutDropdown = null;
            }
            
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function openExerciseModal(id) {
            const exercise = exercises.find(e => e.id === id);
            
            if (exercise) {
                document.getElementById('edit-exercise-id').value = exercise.id;
                document.getElementById('edit-exercise-name').value = exercise.name;
                document.getElementById('edit-exercise-category').value = exercise.category;
                document.getElementById('edit-exercise-description').value = exercise.description || '';
                
                document.getElementById('exercise-modal').classList.add('active');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                if (activeDropdown) {
                    activeDropdown.classList.remove('show');
                    activeDropdown = null;
                }
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function closeExerciseModal() {
            document.getElementById('exercise-modal').classList.remove('active');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function saveExerciseChanges() {
            const id = parseInt(document.getElementById('edit-exercise-id').value);
            const name = document.getElementById('edit-exercise-name').value.trim();
            const category = document.getElementById('edit-exercise-category').value;
            const description = document.getElementById('edit-exercise-description').value.trim();
            
            if (!name || !category) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }
            
            const index = exercises.findIndex(e => e.id === id);
            if (index !== -1) {
                exercises[index] = {
                    ...exercises[index],
                    name,
                    category,
                    description
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤–æ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
                workouts.forEach(workout => {
                    if (workout.exerciseId === id) {
                        workout.exerciseCategory = category;
                    }
                });
                
                localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
                localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                loadCategories();
                loadExercises();
                updateExerciseDropdown();
                updateStats();
                updateChart();
                
                closeExerciseModal();
                showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function editWorkout(id) {
            const workout = workouts.find(w => w.id === id);
            if (!workout) return;
            
            // –£–¥–∞–ª—è–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π
            workouts = workouts.filter(w => w.id !== id);
            localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ñ–æ—Ä–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            document.querySelector('.tab[data-tab="workouts"]').classList.add('active');
            document.getElementById('workouts-tab').classList.add('active');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
            document.getElementById('workout-exercise').value = workout.exerciseId;
            document.getElementById('workout-date').value = workout.date;
            document.getElementById('difficulty').value = workout.difficulty || '';
            document.getElementById('notes').value = workout.notes || '';
            
            if (workout.exerciseCategory === '–ö–∞—Ä–¥–∏–æ') {
                document.getElementById('standard-fields').classList.add('hidden-field');
                document.getElementById('cardio-fields').classList.remove('hidden-field');
                document.getElementById('level').value = workout.level || '';
                document.getElementById('distance').value = workout.distance || '';
            } else {
                document.getElementById('standard-fields').classList.remove('hidden-field');
                document.getElementById('cardio-fields').classList.add('hidden-field');
                document.getElementById('weight').value = workout.weight || '';
                document.getElementById('reps').value = workout.reps || '';
                document.getElementById('sets').value = workout.sets || '';
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
            if (activeWorkoutDropdown) {
                activeWorkoutDropdown.classList.remove('show');
                activeWorkoutDropdown = null;
            }
            
            showNotification('–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function initCalendar() {
            renderCalendar();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const title = document.getElementById('calendar-title');
            
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            title.textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            let firstDayOfWeek = firstDay.getDay();
            if (firstDayOfWeek === 0) firstDayOfWeek = 6;
            else firstDayOfWeek--;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            const workoutDates = new Set();
            workouts.forEach(workout => {
                const date = new Date(workout.date);
                const dateString = formatDateForComparison(date);
                workoutDates.add(dateString);
            });
            
            calendar.innerHTML = '';
            
            const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            dayNames.forEach(dayName => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = dayName;
                calendar.appendChild(dayHeader);
            });
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendar.appendChild(emptyDay);
            }
            
            const daysInMonth = lastDay.getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDate = new Date(year, month, day);
                const dateString = formatDateForComparison(dayDate);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                dayElement.dataset.date = dateString;
                
                const hasWorkout = workoutDates.has(dateString);
                if (hasWorkout) {
                    dayElement.classList.add('has-workout');
                }
                
                if (selectedCalendarDate === dateString) {
                    dayElement.classList.add('selected');
                }
                
                dayElement.addEventListener('click', () => {
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–∞—Ç—ã
                    document.querySelectorAll('.calendar-day.selected').forEach(d => {
                        d.classList.remove('selected');
                    });
                    
                    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
                    dayElement.classList.add('selected');
                    selectedCalendarDate = dateString;
                    
                    if (hasWorkout) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å
                        showDayWorkouts(dateString);
                    } else {
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π
                        openNewWorkoutWithDate(dateString);
                    }
                });
                
                calendar.appendChild(dayElement);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π
        function openNewWorkoutWithDate(dateString) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            document.querySelector('.tab[data-tab="workouts"]').classList.add('active');
            document.getElementById('workouts-tab').classList.add('active');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
            document.getElementById('workout-date').value = dateString;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
            document.getElementById('workout-form-card').scrollIntoView({ behavior: 'smooth' });
            
            // –û—á–∏—â–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–Ω—è
            document.getElementById('selected-day-workouts').innerHTML = '';
            
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ ' + formatDisplayDate(dateString), 'info');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function formatDisplayDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å
        function showDayWorkouts(date) {
            const container = document.getElementById('selected-day-workouts');
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ —ç—Ç—É –¥–∞—Ç—É
            const dayWorkouts = workouts.filter(w => {
                const workoutDate = new Date(w.date);
                const workoutDateString = formatDateForComparison(workoutDate);
                return workoutDateString === date;
            });
            
            if (dayWorkouts.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                weekday: 'long'
            });
            
            let html = `
                <div class="date-header">
                    <div class="date-title">${formattedDate}</div>
                    <div class="date-workout-count">${dayWorkouts.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                </div>
            `;
            
            dayWorkouts.forEach(workout => {
                const exercise = exercises.find(e => e.id === workout.exerciseId);
                if (!exercise) return;
                
                html += `
                    <div class="workout-item">
                        <div class="workout-header">
                            <div class="workout-date">${workout.exerciseName}</div>
                            <button class="workout-more-btn" onclick="showWorkoutMenu(event, ${workout.id})">‚ãØ</button>
                        </div>
                        
                        <div class="workout-stats">
                            ${exercise.category === '–ö–∞—Ä–¥–∏–æ' ? `
                                <div class="stat">
                                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                                    <div class="stat-value">${workout.level || '0'}</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="stat-value">${workout.distance || '0'} –∫–º</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–¢–∏–ø</div>
                                    <div class="stat-value">–ö–∞—Ä–¥–∏–æ</div>
                                </div>
                            ` : `
                                <div class="stat">
                                    <div class="stat-label">–í–µ—Å</div>
                                    <div class="stat-value">${workout.weight} –∫–≥</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                                    <div class="stat-value">${workout.reps}</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">–ü–æ–¥—Ö–æ–¥—ã</div>
                                    <div class="stat-value">${workout.sets}</div>
                                </div>
                            `}
                        </div>
                        
                        ${workout.difficulty ? `<div style="margin-top: 10px; color: #7f8c8d;">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ${workout.difficulty}</div>` : ''}
                        ${workout.notes ? `<div style="margin-top: 5px; color: #7f8c8d; font-style: italic;">${workout.notes}</div>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            document.getElementById('total-exercises').textContent = exercises.length;
            
            // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            const uniqueDates = new Set();
            workouts.forEach(workout => {
                const date = new Date(workout.date);
                const dateString = formatDateForComparison(date);
                uniqueDates.add(dateString);
            });
            document.getElementById('total-workouts').textContent = uniqueDates.size;
            
            // –õ—É—á—à–∏–π –≤–µ—Å –∏ –¥–∞—Ç–∞
            const weightWorkouts = workouts.filter(w => w.exerciseCategory !== '–ö–∞—Ä–¥–∏–æ' && w.weight > 0);
            if (weightWorkouts.length > 0) {
                const bestWorkout = weightWorkouts.reduce((best, current) => 
                    current.weight > best.weight ? current : best
                );
                document.getElementById('best-weight').textContent = bestWorkout.weight;
                
                const date = new Date(bestWorkout.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                document.getElementById('best-weight-date').textContent = date;
            } else {
                document.getElementById('best-weight').textContent = '0';
                document.getElementById('best-weight-date').textContent = '-';
            }
            
            // –ü–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
            if (workouts.length > 0) {
                const lastWorkout = workouts.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                const date = new Date(lastWorkout.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short'
                });
                document.getElementById('last-workout').textContent = date;
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        let progressChart = null;

        function updateChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const recentWorkouts = workouts
                .filter(w => new Date(w.date) >= thirtyDaysAgo && w.exerciseCategory !== '–ö–∞—Ä–¥–∏–æ')
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∏ –Ω–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –∑–∞ –¥–µ–Ω—å
            const workoutData = {};
            recentWorkouts.forEach(workout => {
                const date = new Date(workout.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short'
                });
                
                if (!workoutData[date]) {
                    workoutData[date] = [];
                }
                workoutData[date].push(workout.weight);
            });
            
            const labels = Object.keys(workoutData);
            const data = labels.map(date => {
                const weights = workoutData[date];
                return Math.max(...weights);
            });
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            if (labels.length > 0) {
                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å (–∫–≥)',
                            data: data,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#27ae60',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            }
                        }
                    }
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function createBackup() {
            try {
                const backupData = {
                    exercises: exercises,
                    workouts: workouts,
                    backupDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('workoutDiaryBackupData', JSON.stringify(backupData));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                backupSettings.lastBackup = new Date().toISOString();
                backupSettings.reminderShown = true;
                localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                updateBackupInfo();
                
                showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', 'error');
            }
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function restoreBackup() {
            try {
                const backupData = localStorage.getItem('workoutDiaryBackupData');
                
                if (!backupData) {
                    showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                if (!confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
                    return;
                }
                
                const data = JSON.parse(backupData);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                exercises = data.exercises || [];
                workouts = data.workouts || [];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
                localStorage.setItem('workoutDiaryWorkouts', JSON.stringify(workouts));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                loadCategories();
                loadExercises();
                loadWorkouts();
                updateExerciseDropdown();
                updateStats();
                renderCalendar();
                updateChart();
                
                showNotification('–î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function updateBackupInfo() {
            const backupInfo = document.getElementById('backup-info');
            
            if (backupSettings.lastBackup) {
                const lastBackupDate = new Date(backupSettings.lastBackup);
                const formattedDate = lastBackupDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                backupInfo.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: ${formattedDate}`;
            } else {
                backupInfo.textContent = '–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
        function checkBackupReminder() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–∞ –ª–∏ –Ω–µ–¥–µ–ª—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            if (backupSettings.lastBackup) {
                const lastBackupDate = new Date(backupSettings.lastBackup);
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                if (lastBackupDate < oneWeekAgo && !backupSettings.reminderShown) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
                    setTimeout(() => {
                        if (confirm('–ü—Ä–æ—à–ª–∞ –Ω–µ–¥–µ–ª—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Å–µ–π—á–∞—Å?')) {
                            createBackup();
                        } else {
                            // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ
                            backupSettings.reminderShown = true;
                            localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                        }
                    }, 2000);
                }
            } else if (!backupSettings.reminderShown) {
                // –ï—Å–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ–∑–¥–∞—Ç—å
                setTimeout(() => {
                    if (confirm('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞—Ç—å —Å–µ–π—á–∞—Å?')) {
                        createBackup();
                    } else {
                        backupSettings.reminderShown = true;
                        localStorage.setItem('workoutDiaryBackup', JSON.stringify(backupSettings));
                    }
                }, 2000);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        function createProgressChart(exerciseId, category) {
            const exerciseWorkouts = workouts
                .filter(w => w.exerciseId === exerciseId)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-7);
            
            if (exerciseWorkouts.length < 2) {
                return '<div style="font-size: 0.8em; color: #95a5a6; text-align: center; margin-top: 5px;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</div>';
            }
            
            let values;
            if (category === '–ö–∞—Ä–¥–∏–æ') {
                values = exerciseWorkouts.map(w => parseFloat(w.level) || 0);
            } else {
                values = exerciseWorkouts.map(w => w.weight);
            }
            
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);
            const range = maxValue - minValue;
            
            let chartHTML = '<div class="progress-chart">';
            chartHTML += '<div class="chart-line"></div>';
            
            exerciseWorkouts.forEach((workout, index) => {
                let chartValue;
                if (category === '–ö–∞—Ä–¥–∏–æ') {
                    chartValue = parseFloat(workout.level) || 0;
                } else {
                    chartValue = workout.weight;
                }
                
                const normalizedValue = range > 0 ? (chartValue - minValue) / range : 0.5;
                const xPosition = (index / (exerciseWorkouts.length - 1)) * 100;
                const yPosition = 100 - (normalizedValue * 80 + 10);
                
                chartHTML += `<div class="chart-point" style="left: ${xPosition}%; top: ${yPosition}%;"></div>`;
            });
            
            chartHTML += '</div>';
            return chartHTML;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –ø—É—Å—Ç–æ)
        if (exercises.length === 0) {
            exercises = [
                { id: 1, name: '–ë–µ–≥ –Ω–∞ –¥–æ—Ä–æ–∂–∫–µ', category: '–ö–∞—Ä–¥–∏–æ', description: '–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞', createdAt: new Date().toISOString() },
                { id: 2, name: '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π', category: '–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã', description: '–ë–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', createdAt: new Date().toISOString() },
                { id: 3, name: '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞', category: '–ì—Ä—É–¥—å –∏ –ø—Ä–µ—Å—Å', description: '–ñ–∏–º –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∫–∞–º—å–µ', createdAt: new Date().toISOString() },
                { id: 4, name: '–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞', category: '–†—É–∫–∏ –∏ —Å–ø–∏–Ω–∞', description: '–¢—è–≥–∞ –∫ –≥—Ä—É–¥–∏', createdAt: new Date().toISOString() }
            ];
            localStorage.setItem('workoutDiaryExercises', JSON.stringify(exercises));
            
            loadCategories();
            loadExercises();
            updateExerciseDropdown();
        }
    </script>
</body>
</html>
